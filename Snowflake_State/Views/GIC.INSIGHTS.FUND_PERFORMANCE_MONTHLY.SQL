CREATE OR REPLACE VIEW GIC.INSIGHTS.FUND_PERFORMANCE_MONTHLY (
    DATEMTH DATE,
    FUND VARCHAR,
    CUMULATIVE_PROFIT_LOSS VARCHAR
) AS
WITH CTE1 AS
(
SELECT 
DATE_TRUNC('MONTH', GIC.INTERMEDIATE.EXTERNAL_FUNDS.DATE) AS DATEMTH,
GIC.INTERMEDIATE.EXTERNAL_FUNDS.FUND,
SUM(GIC.INTERMEDIATE.EXTERNAL_FUNDS.REALISED_PL) AS CUMULATIVE_PROFIT_LOSS,
FROM GIC.INTERMEDIATE.EXTERNAL_FUNDS
WHERE GIC.INTERMEDIATE.EXTERNAL_FUNDS.FINANCIAL_TYPE = 'Equities'
GROUP BY DATEMTH, FUND
),
CTE2 AS 
(
SELECT *, ROW_NUMBER() OVER (PARTITION BY DATEMTH ORDER BY CUMULATIVE_PROFIT_LOSS DESC) AS RANK FROM CTE
WHERE RANK = 1
)
SELECT DATEMTH, FUND, CUMULATIVE_PROFIT_LOSS FROM CTE2
;